import time

from config import *
from lib import led
from lib.colors import *

CHARS = {
    "A": [[0, 1, 0], [1, 0, 1], [1, 1, 1], [1, 0, 1], [1, 0, 1]],
    "B": [[1, 1, 0], [1, 0, 1], [1, 1, 0], [1, 0, 1], [1, 1, 0]],
    "C": [[1, 1, 1], [1, 0, 0], [1, 0, 0], [1, 0, 0], [1, 1, 1]],
    "D": [[1, 1, 0], [1, 0, 1], [1, 0, 1], [1, 0, 1], [1, 1, 0]],
    "E": [[1, 1, 1], [1, 0, 0], [1, 1, 0], [1, 0, 0], [1, 1, 1]],
    "F": [[1, 1, 1], [1, 0, 0], [1, 1, 0], [1, 0, 0], [1, 0, 0]],
    "G": [[1, 1, 1], [1, 0, 0], [1, 0, 1], [1, 0, 1], [1, 1, 1]],
    "H": [[1, 0, 1], [1, 0, 1], [1, 1, 1], [1, 0, 1], [1, 0, 1]],
    "I": [[1], [1], [1], [1], [1]],
    "J": [[0, 0, 1], [0, 0, 1], [0, 0, 1], [1, 0, 1], [0, 1, 0]],
    "K": [[1, 0, 1], [1, 1, 0], [1, 0, 0], [1, 1, 0], [1, 0, 1]],
    "L": [[1, 0, 0], [1, 0, 0], [1, 0, 0], [1, 0, 0], [1, 1, 1]],
    "M": [[1, 0, 0, 0, 1], [1, 1, 0, 1, 1], [1, 0, 1, 0, 1], [1, 0, 0, 0, 1], [1, 0, 0, 0, 1]],
    "N": [[1, 0, 0, 1], [1, 0, 0, 1], [1, 1, 0, 1], [1, 0, 1, 1], [1, 0, 0, 1]],
    "O": [[1, 1, 1], [1, 0, 1], [1, 0, 1], [1, 0, 1], [1, 1, 1]],
    "P": [[1, 1, 0], [1, 0, 1], [1, 1, 0], [1, 0, 0], [1, 0, 0]],
    "Q": [[1, 1, 1], [1, 0, 1], [1, 0, 1], [1, 1, 1], [1, 0, 1]],
    "R": [[1, 1, 0], [1, 0, 1], [1, 1, 0], [1, 1, 0], [1, 0, 1]],
    "S": [[1, 1, 1], [1, 0, 0], [1, 1, 1], [0, 0, 1], [1, 1, 1]],
    "T": [[1, 1, 1], [0, 1, 0], [0, 1, 0], [0, 1, 0], [0, 1, 0]],
    "U": [[1, 0, 1], [1, 0, 1], [1, 0, 1], [1, 0, 1], [1, 1, 1]],
    "V": [[1, 0, 1], [1, 0, 1], [1, 0, 1], [1, 0, 1], [0, 1, 0]],
    "W": [[1, 0, 0, 0, 1], [1, 0, 0, 0, 1], [1, 0, 1, 0, 1], [1, 1, 0, 1, 1], [1, 0, 0, 0, 1]],
    "x": [[0, 0, 0], [0, 0, 0], [1, 0, 1], [0, 1, 0], [1, 0, 1]],
    "X": [[1, 0, 1], [1, 0, 1], [0, 1, 0], [1, 0, 1], [1, 0, 1]],
    "Y": [[1, 0, 1], [1, 0, 1], [0, 1, 0], [0, 1, 0], [0, 1, 0]],
    "Z": [[1, 1, 1], [0, 0, 1], [0, 1, 0], [1, 0, 0], [1, 1, 1]],
    "0": [[0, 1, 0], [1, 0, 1], [1, 0, 1], [1, 0, 1], [0, 1, 0]],
    "1": [[0, 1], [1, 1], [0, 1], [0, 1], [0, 1]],
    " ": [[0], [0], [0], [0], [0]]
}


def _colorize(screen):
    colored = []
    for x in screen:
        layer = []
        for y in x:
            if y == 1:
                layer.append(get_fg())
            else:
                layer.append(get_bg())
        colored.append(layer)
    return colored


def char(c):
    if c in CHARS:
        return _colorize(CHARS[c])
    else:
        return _colorize(CHARS[c.upper()])


def string(string):
    first = True
    r_word = [[], [], [], [], []]
    for raw_char in string:
        r_char = char(raw_char)
        for i, row in enumerate(r_word):
            if not first:
                row.append(get_bg())
            for val in r_char[i]:
                row.append(val)
        first = False
    return r_word


def gliding_text(text, y=0):
    old_bg = get_bg()
    set_bg(COLOR_BLACK)
    print(get_bg())
    rendered = string(text)
    for shift in range(len(rendered[0]) - LED_COLUMNS + 1):
        led.draw_screen(rendered, -shift, y)
        time.sleep(TEXT_GLIDING_DELAY / 1000.0)
    set_bg(old_bg)
